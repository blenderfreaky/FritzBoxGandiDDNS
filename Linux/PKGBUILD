pkgname=fritzbox-gandi-ddns
pkgver=0.0.3
pkgrel=1

pkgdesc="Listen to Fritz!BOX DDNS IP Updates and update Gandi DNS entries accordingly"
url="https://github.com/blenderfreaky/FritzBoxGandiDDNS"
source=("$pkgname-$pkgver.tar.gz::https://github.com/blenderfreaky/FritzBoxGandiDDNS/archive/v$pkgver.tar.gz")
arch=('any')
license=('MIT')
options=('!strip')
backup=('usr/bin/fritzbox-gandi-ddns/appsettings.json')

makedepends=('aspnet-runtime')
depends=('aspnet-targeting-pack')

source=(https://github.com/blenderfreaky/FritzBoxGandiDDNS/archive/v$pkgver.tar.gz
        fritzbox-gandi-ddns.service)

sha512sums=('8ec75b23832f72252b8d2276d3e47118b700859fa65f5ead44250d59b068cff2f7adddc79572bd7b98eb02d0783bb8d53e40e7db7268035eeebb7aab769a8e7d'
            '215282d8568bc258d442fa99c6c03683ce00066d01ab35ae1e1af82e481a312bb27823bf9e68375e0bef18861cc27a4ede89467bebdb4bdeca84cfde8f50d6e8')

build() {
  cd "$srcdir/FritzBoxGandiDDNS-$pkgver/FritzBoxGandiDDNS"

  dotnet publish --use-current-runtime -c Release -o fritzbox-gandi-ddns
}

package() {
  cd "$srcdir/FritzBoxGandiDDNS-$pkgver/FritzBoxGandiDDNS"

  install -Dm755 fritzbox-gandi-ddns/FritzBoxGandiDDNS "$pkgdir/usr/bin/fritzbox-gandi-ddns/fritzbox-gandi-ddns"
  install -Dm644 fritzbox-gandi-ddns/appsettings.json "$pkgdir/usr/bin/fritzbox-gandi-ddns/appsettings.json"
  
  install -Dm644 "$srcdir/fritzbox-gandi-ddns.service" "$pkgdir"/usr/lib/systemd/system/fritzbox-gandi-ddns.service
}