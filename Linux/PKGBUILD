pkgname=fritzbox-gandi-ddns
pkgver=0.0.3
pkgrel=1

pkgdesc="Listen to Fritz!BOX DDNS IP Updates and update Gandi DNS entries accordingly"
url="https://github.com/blenderfreaky/FritzBoxGandiDDNS"
source=("$pkgname-$pkgver.tar.gz::https://github.com/blenderfreaky/FritzBoxGandiDDNS/archive/v$pkgver.tar.gz")
arch=('any')
license=('MIT')
options=('!strip')
backup=('usr/bin/fritzbox-gandi-ddns/appsettings.json')

makedepends=('aspnet-runtime')
depends=('aspnet-targeting-pack')

source=(https://github.com/blenderfreaky/FritzBoxGandiDDNS/archive/v$pkgver.tar.gz
        fritzbox-gandi-ddns.service)

sha512sums=('45a1acec0cb3c24c8c4e311b39b2493719bc1bd73fd1bde5a42ae82d5f8f205e075137fae59c8c5ccbb89d2a7235a86b587beb50d8d87d9bdfc112d3df1acd6d'
            '8EC75B23832F72252B8D2276D3E47118B700859FA65F5EAD44250D59B068CFF2F7ADDDC79572BD7B98EB02D0783BB8D53E40E7DB7268035EEEBB7AAB769A8E7D')

build() {
  cd "$srcdir/FritzBoxGandiDDNS-$pkgver/FritzBoxGandiDDNS"

  dotnet publish --use-current-runtime -c Release -o fritzbox-gandi-ddns
}

package() {
  cd "$srcdir/FritzBoxGandiDDNS-$pkgver/FritzBoxGandiDDNS"

  install -Dm755 fritzbox-gandi-ddns/FritzBoxGandiDDNS "$pkgdir/usr/bin/fritzbox-gandi-ddns/fritzbox-gandi-ddns"
  install -Dm644 fritzbox-gandi-ddns/appsettings.json "$pkgdir/usr/bin/fritzbox-gandi-ddns/appsettings.json"
  
  install -Dm644 "$srcdir/fritzbox-gandi-ddns.service" "$pkgdir"/usr/lib/systemd/system/fritzbox-gandi-ddns.service
}